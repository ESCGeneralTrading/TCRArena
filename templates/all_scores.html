<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Soccer Scores - TCR Arena</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
    html, body {
        height: 100%;
        margin: 0;
    }

    body {
        font-family:  'Montserrat', sans-serif;
        background: #f9fafb;
        color: #1f1f1f;
        display: flex;
        flex-direction: column;
        min-height: 100vh; /* ensures footer sticks to bottom */
    }

    main {
        flex: 1; /* main content takes all available space */
    }

    .top-black-bar {
        background-color: #000;
        color: #fff;
        height: 30px;
        display: flex;
        align-items: center;
        padding: 0 1rem;
        font-weight: normal;
        font-size: 0.9rem;
        position: sticky;
        top: 0;
        z-index: 1100;
        /* overflow: hidden; */
        overflow: visible;
    }

    .top-black-bar marquee { width: 100%; }

    .logo-banner {
      background: #fff;
      text-align: center;
      padding: 1.5rem 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .logo-banner img {
      height: 170px;
      width: auto;
    }

    header {
      background: #000;
      color: #fff;
      padding: 1rem 0;
      position: sticky;
      top: 30px;
      z-index: 1000;
    }

    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    nav {
      display: flex;
      flex-wrap: wrap;
      gap: 4rem;
      justify-content: center;
      flex-grow: 1;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      font-size: 1rem;
    }
    
    .nav-toggle {
      display: none;
      flex-direction: column;
      justify-content: space-around;
      width: 25px;
      height: 20px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .nav-toggle span {
      display: block;
      height: 3px;
      background: #fff;
      border-radius: 2px;
    }
    
    /* Tablet + Mobile Nav */
    @media (max-width: 1024px) {
      .header-container {
        flex-direction: column;
        align-items: flex-start;
      }
      nav {
        display: none;
        flex-direction: column;
        width: 100%;
        background: #000;
        margin-top: 0.5rem;
        padding: 1rem;
        border-radius: 4px;
        gap: 1.5rem;
      }
      nav.active {
        display: flex;
      }
      .nav-toggle {
        display: flex;
        align-self: flex-end;
        margin-bottom: 0.5rem;
      }
    }

    h1,h2 { text-align: center; margin: 15px 0; color: #222; }

    h1 { margin-bottom:20px;color:#0c0c0c; }
    h2 { margin-top:30px; color:#0c0c0c; }

    .scores-wrapper,
    #matches-container {
        display: flex;
        flex-wrap: nowrap;       
        overflow-x: auto;        
        gap: 15px;
        padding: 10px;
        scroll-behavior: smooth;
        justify-content: center;
        align-items: flex-start; /* prevent stretching */
    }
    #matches-container {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 15px;
        padding: 10px 20px; /* left and right padding adds space before first and after last card */
        scroll-behavior: smooth;
        justify-content: flex-start; /* keeps cards aligned from left */
    }


    .scores-wrapper::-webkit-scrollbar,
    #matches-container::-webkit-scrollbar {
        height: 8px;
    }
    .scores-wrapper::-webkit-scrollbar-thumb,
    #matches-container::-webkit-scrollbar-thumb {
        background-color: #555;
        border-radius: 4px;
    }

    .match-card {
        background:#1c1c1c;
        border-radius:10px;
        padding:18px 10px;
        width: 220;
        flex: 0 0 auto;           
        box-shadow:0 4px 8px rgba(0,0,0,0.4);
        transition:0.2s;
        display:flex;
        flex-direction:column;
        justify-content:flex-start;
        align-items:center;
        position:relative;
    }
    .match-card:hover { transform: translateY(-3px); }

    .team-name, .score, .match-header, .events strong, .match-info { text-align:center;font-size:0.85rem;color: white; }
    .score { font-weight:700; font-size:1.4rem; margin:6px 0; color:#ff7f50; }
    .match-header { font-size:17px; font-weight:bold; color:#ccc; margin-bottom:6px; }

    .match-card.live::before { 
        content:"LIVE"; 
        background:red; 
        padding:2px 4px; 
        position:absolute; 
        top:4px; left:6px; 
        border-radius:3px; 
        font-size:8px; 
        font-weight:bold; 
        color:#fff; 
    }

    .match-card.upcoming::before { 
        content:"UPCOMING"; 
        background:green; 
        padding:2px 4px; 
        position:absolute; 
        top:4px; left:6px; 
        border-radius:3px; 
        font-size:8px; 
        font-weight:bold; 
        color:#fff; 
    }

    .match-card.past::before { 
        content:"FINISHED"; 
        background:gray; 
        padding:2px 4px; 
        position:absolute; 
        top:4px; left:6px; 
        border-radius:3px; 
        font-size:8px; 
        font-weight:bold; 
        color:#fff; 
    }

    .match-card.past { 
        background: linear-gradient(145deg, #2a2a2a, #1a1a1a); 
        border-left:4px solid #888; 
    }
    .match-card.past:hover { 
        transform: translateY(-2px); 
        box-shadow:0 6px 12px rgba(0,0,0,0.6); 
    }

    .button-container { text-align:center; margin-bottom:10px; }
    .button-container button {
        padding: 10px 20px;
        background-color: #000000;
        border: 4px solid #ffffff; /* added border */
        color: #fff;
        cursor: pointer;
        border-radius: 50px;
        font-size: 14px;
        margin: 4px;
        transition: 0.3s;
        white-space: nowrap;      
        min-width: 100px;        
        text-overflow: ellipsis;  
        overflow: hidden;         
    }

    .button-container button:hover {
        background-color: #0056b3;
        border-color: #fff; /* optional: change border color on hover */
    }

    #match-date { display:block; margin:10px auto; color:#0c0c0c;}

    /* Professional Event styling */
    .events {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        width: 100%;
        margin-top: 10px;
        border-radius: 8px;
        background: #222;
        padding: 0;
        box-sizing: border-box;
    }
    .events.show {
        max-height: 500px;
    }
    .event-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-bottom: 1px solid #333;
        font-size: 13px;
        color: #eee;
    }
    .event-item:last-child { border-bottom: none; }
    .event-type {
        font-weight: bold;
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 4px;
        color: #fff;
        text-transform: uppercase;
        white-space: nowrap;
    }
    .event-type.goal { background: #28a745; }        
    .event-type.booking { background: #ffc107; }     
    .event-type.substitution { background: #17a2b8; } 
    .event-info { flex: 1; }
    .event-time { font-size: 11px; color: #aaa; white-space: nowrap; }

    #league-row {
        background-color: #000;
    }

    #matches-row {
        background-color: #fff;
    }

    @media(max-width:768px){ 
        .team-name{font-size:13px;} 
        .score{font-size:24px;} 
    }
    @media(max-width:480px){ 
        .match-card{padding:15px;} 
        .team-name{font-size:14px;} 
        .score{font-size:22px;} 
    }

    .status-live { color: #d9534f; font-weight: 700; }
    .status-finished { color: #28a745; font-weight: 700; }
    .status-upcoming { color: #ffc107; font-weight: 700; }

    .expand-btn { cursor: pointer; background: #ff7f50; color: #fff; border: none; padding: 8px 14px; border-radius: 6px; font-weight: 600; transition: all 0.2s; margin: 20px auto 0; display: block; width: fit-content; }
    .expand-btn:hover { background: #e67343; transform: scale(1.05); }

    .events-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    .events-table th1 { background: #007bff; color: #fff; font-weight: 500; font-size: 13px; padding: 8px; border-radius: 4px; }
    .events-table th { background: #333; color: #fff; font-weight: 500; font-size: 13px; padding: 8px; border-radius: 4px; }
    .events-table td { font-size: 13px; padding: 8px; border-bottom: 1px solid #eee; text-align: center; }

    #filter-league-venue { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; width: 250px; transition: all 0.2s; }
    #filter-league-venue:focus { border-color: #007bff; box-shadow: 0 0 6px rgba(0,123,255,0.2); }

    /* Center headers for top players and fighters */
    #players-header,
    #fighters-header {
        text-align: center;          /* Center the text */
        font-size: 1.5rem;           /* Base font size */
        font-weight: 600;            /* Bold header */
        margin: 20px 0;              /* Spacing above and below */
        color: #222;                 /* Dark color for readability */
        word-wrap: break-word;       /* Wrap long text on smaller screens */
        padding: 0 10px;             /* Small padding for mobile */
    }

    /* Make text responsive */
    @media (max-width: 768px) {
        #players-header,
        #fighters-header {
            font-size: 1.1rem;       /* Slightly smaller on tablets */
        }
    }

    @media (max-width: 480px) {
        #players-header,
        #fighters-header {
            font-size: 1rem;       /* Smaller on mobile */
        }
    }

    .oval-button {
        background-color: black;
        color: white;
        border: 3px solid white;
        border-radius: 50px; /* more rounded for true oval */
        padding: 10px 25px;
        font-weight: bold;
        font-size: 1rem;  
        cursor: pointer;
        transition: all 0.2s;
        min-width: 120px;        /* ensures buttons don't get too small */
        text-align: center;
        flex: 1 1 auto;          /* allows buttons to grow/shrink */
        max-width: 200px;        /* prevents extremely wide buttons */
    }

    .oval-button:hover {
        background-color: #333;
        transform: scale(1.05);
    }

    /* Container to manage button wrapping */
    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }

    /* Responsive adjustments for smaller screens */
    @media (max-width: 768px) {
        .oval-button {
            padding: 8px 16px;
            font-size: 0.9rem;
            min-width: 90px;
            max-width: 100%;
        }
    }

    @media (max-width: 480px) {
        .oval-button {
            padding: 6px 12px;
            font-size: 0.85rem;
            min-width: 70px;
        }
    }

    .error { color: red; font-weight: 500; }

    footer {
        background: #000;
        color: #fff;
        text-align: center;
        padding: 2rem 1rem;
        font-size: 0.9rem;
    }
    footer a {
        color: #ffd700;
        text-decoration: underline;
    }

    /* Collapsible / Tabs / Responsive Styles */
    .collapsible-wrapper { position: relative; display: inline-block; }
    .players-list { display: none; position: absolute; top: 100%; left: 0; background: #fff; list-style: none; margin: 0; padding: 8px 0; border: 1px solid #ddd; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 999; min-width: 160px; }
    .players-list li { padding: 10px 16px; cursor: pointer; font-weight: 500; color: #021638; }
    .players-list li:hover { background: #f2f2f2; }
    .table-header-row th {
        background-color: #227fe3; /* Example: orange for the main header */
        color: #fff;
        text-align: center;
        font-size: 1.2rem;
        padding: 10px;
    }

    .table-column-headers th {
        background-color: #333; /* Dark grey for column headers */
        color: #fff;
        font-weight: 600;
        font-size: 13px;
        padding: 8px;
    }

    .events-table td {
        font-size: 13px;
        padding: 8px;
        border-bottom: 1px solid #eee;
        text-align: center;
    }

    .tabs-container { display: flex; justify-content: center; margin: 30px 0; flex-wrap: wrap; gap: 9px; font-family: 'Montserrat', sans-serif; }
    .tab-button { background-color: transparent; border: none; padding: 12px 24px; cursor: pointer; color: #021638; font-weight: bold; font-size: 1rem; text-decoration: none; transition: all 0.2s; }
    .tab-button:hover { text-decoration: underline; }
    .tab-button.active { text-decoration: underline; }

    .tab-content { display: none; max-width: 1490px; margin: 0 auto 40px auto; }
    /* Make tabs inline and scrollable on small screens */
    @media (max-width: 480px) {
    .tabs-container {
        flex-wrap: nowrap;      
        justify-content: space-between; 
        padding: 0 5px;
        position: relative; /* ensure dropdowns are positioned relative to container */
    }

    .tabs-container .tab-button,
    .collapsible-wrapper > .tab-button {
        flex: 1 1 0;            
        font-size: 0.75rem;     
        padding: 6px 4px;
        text-align: center;
        white-space: nowrap;
        min-width: 0;           
    }

    /* Dropdown lists open absolutely below button */
    .collapsible-wrapper {
        position: relative; /* parent wrapper is relative */
    }

    .players-list, .fighters-list {
        display: none;
        position: absolute; /* float over content, no push */
        top: 100%;          /* directly below button */
        left: 0;
        right: 0;           /* full width of button */
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        z-index: 999;
        margin-top: 4px;
    }

    .players-list li, .fighters-list li {
        padding: 10px 16px;
        cursor: pointer;
        font-weight: 500;
        color: #021638;
    }

    .players-list li:hover, .fighters-list li:hover {
        background: #f2f2f2;
    }
}
    

    /* @media(max-width: 1024px){ .logo-banner img { max-height: 10vh; } .teams { font-size: 16px; } .score { font-size: 1.1rem; width: 60px; } } */
    @media(max-width: 768px){ .match-header { flex-direction: column; align-items: flex-start; } .teams { flex-direction: column; align-items: flex-start; line-height: 1.5rem; } .score { margin: 5px 0; } #filter-league-venue { width: 100%; margin-bottom: 10px; } }
    /* @media(max-width: 480px){ .logo-banner img { max-height: 8vh; } .teams { font-size: 14px; } .score { font-size: 1rem; width: 50px; } #search-section input, #search-section button { font-size: 13px; padding: 10px 14px; } } */

    .live-dot { display: inline-block; width: 13px; height: 13px; margin-left: 4px; margin-top: -2px; border-radius: 30%; background-color: #d9534f; position: relative; vertical-align: middle; animation: pulse 1.2s infinite; }
    .live-dot::after { content: ''; position: absolute; top: 3px; left: 3px; width: 7px; height: 7px; background: #fff; border-radius: 50%; }
    @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.6; } 100% { transform: scale(1); opacity: 1; } }

</style>
</head>
<body>

<!-- Black top band with marquee -->
  <div class="top-black-bar">
    <marquee behavior="scroll" direction="left" scrollamount="8" onmouseover="this.stop();" onmouseout="this.start();">
      Join TcR Arena — get 20% off all signed memorabilia at The Collect Room&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Exclusive offers, rare collectibles, limited editions &amp; more!&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Sign up today and never miss a deal!
    </marquee>
  </div>

<div class="logo-banner">
    <a href="{{ url_for('home') }}">
        <img src="{{ url_for('static', filename='arena.png') }}" alt="TCR Arena Logo">
    </a>
</div>

<!-- Header / Nav -->
  <header>
    <div class="header-container">
      <div class="nav-toggle" id="navToggle" aria-label="Toggle navigation" role="button" tabindex="0">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <nav id="navMenu">
        <a href="{{ url_for('blog', category='Sports') }}">Sports</a>
        <a href="{{ url_for('blog', category='Entertainment') }}">Entertainment</a>
        <a href="{{ url_for('all_scores') }}">Live Scores</a>
        <!-- <a href="{{ url_for('memorabilia') }}">Collectible Stories</a> -->
        <a href="{{ url_for('memorabilia') }}">Collectors Community</a>
        <a href="#">Partner's Tickets</a>
        <a href="https://www.thecollectroom.com/">Shop</a>
        <!-- <a href="{{ url_for('all_videos') }}">Ar▷na Play</a> -->
        <a href="{{ url_for('all_videos') }}">
          Ar <svg 
            width="20" 
            height="20" 
            viewBox="0 0 24 24"
            fill="white" 
            style="vertical-align: middle; border: 1px solid white; padding: 1.5px; box-sizing: content-box; border-radius: 5px;">
            <polygon points="6,4 20,12 6,20" />
          </svg> na Play
        </a>
      </nav>
    </div>
  </header>
    <main>
        <!-- Tabs Navigation -->
        <div class="tabs-container">
            <button class="tab-button active" onclick="openTab(event, 'live')">
                LIVE MATCH <span class="live-dot"></span>
            </button>
            

            <div class="collapsible-wrapper">
                <button class="tab-button" onclick="toggleTableList()">TABLE ▼</button>
                <ul id="table-list" class="players-list">
                    <li onclick="showTable('Football')">Football</li>
                    <li onclick="showTable('Cricket')">Cricket</li>
                </ul>
            </div>

            <div class="collapsible-wrapper">
                <button class="tab-button" onclick="togglePlayersList()">TOP PLAYERS ▼</button>
                <ul id="players-list" class="players-list">
                    <li onclick="showSport('Football')">Football</li>
                    <li onclick="showSport('Basketball')">Basketball</li>
                    <li onclick="showSport('F1 Driver')">F1 Driver</li>
                    <li onclick="showSport('Cricket')">Cricket</li>
                </ul>
            </div>

            <div class="collapsible-wrapper">
                <button class="tab-button" onclick="toggleFightersList()">TOP FIGHTERS ▼</button>
                <ul id="fighters-list" class="players-list">
                    <li onclick="showFighters('MMA')">MMA</li>
                    <li onclick="showFighters('Boxing')">Boxing</li>
                </ul>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="live" class="tab-content" style="display:block;">
            <div class="scores-wrapper">
                {% if matches %}
                    {% if matches[0].league and matches[0].get('home') is none %}
                        <div class="button-container-wrapper">
                            <table id="upcoming-table" style="width:100%; border-collapse:collapse; height: 80px;">
                                <tr id="league-row" style="background:#000000; text-align:center; padding:10px;">
                                    <td>
                                        <div class="button-container" id="league-buttons">
                                            {% for item in matches %}
                                                <button class="league-btn" onclick="fetchNearestUpcoming('{{ item.league }}')">{{ item.league }}</button>
                                            {% endfor %}
                                        </div>
                                    </td>
                                </tr>
                                <tr id="matches-row" style="background:#ffffff; padding:10px;">
                                    <td>
                                        <div id="upcoming-container" style="display:flex; flex-wrap: nowrap; gap:15px; overflow-x:auto; padding:10px 0;"></div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                    {% else %}
                        <!-- Live matches -->
                        {% for match in matches %}
                            <div class="match-card {{ match.status }}">
                                <div class="match-header">{{ match.league }}</div>
                                <div class="team-name">{{ match.home }} vs {{ match.away }}</div>
                                <div class="score">{{ match.score_home }} - {{ match.score_away }}</div>
                                <div class="match-info">
                                    <span>Date: {{ match.date }}</span> | 
                                    <span>Time: {{ match.time }}</span> | 
                                    <span>Venue: {{ match.venue or "TBD" }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% else %}
                    <div style="color:#ff7f50; font-weight:bold; font-size:18px; margin-top:20px;">
                        No live or upcoming matches available.
                    </div>
                {% endif %}
            </div>

            <label for="match-date" style="display: block; text-align: center; margin-bottom: 10px;">
            Select a date:
            </label>

            <input type="date" id="match-date" 
                style="display: block; margin: 10px auto;">

            <button onclick="prepareLeagueButtons()" 
                    style="display: block; margin: 10px auto;">
            Get Matches
            </button>


            <div id="message" style="text-align:center;margin:10px;"></div>

            <h2 id="matches-title" style="display:none;"></h2>
            <div id="matches-buttons" class="button-container" style="display:none;"></div>
            <div id="matches-container" style="display:none;"></div>

            <script>
            const leagues = [
                {name:"UEFA Champions League", label:"Champions League"},
                {name:"England: Premier League", label:"Premier League"},
                {name:"La Liga", label:"La Liga"},
                {name:"Germany: Bundesliga", label:"Bundesliga"},
                {name:"Serie A", label:"Serie A"},
                {name:"Saudi Pro League", label:"Saudi Pro League"},
                {name:"FIFA World Cup", label:"World Cup"},
            ];

            function formatDate(date){ 
                const parts = date.split("-"); 
                return `${parts[2]}.${parts[1]}.${parts[0]}`; 
            }

            function prepareLeagueButtons(){
                const dateInput = document.getElementById("match-date").value;
                if(!dateInput){ alert("Please select a date"); return; }

                const selectedDate = new Date(dateInput);
                const now = new Date();
                now.setHours(0,0,0,0);

                document.getElementById("matches-container").innerHTML="";
                document.getElementById("matches-buttons").innerHTML="";
                document.getElementById("matches-title").style.display="none";
                document.getElementById("matches-buttons").style.display="none";
                document.getElementById("matches-container").style.display="none";

                const targetTitle = document.getElementById("matches-title");
                const targetButtons = document.getElementById("matches-buttons");
                const isPast = selectedDate < now;
                targetTitle.textContent = isPast ? "Past Matches" : "Upcoming Matches";
                targetTitle.style.display = "block";
                targetButtons.style.display = "block";

                leagues.forEach(league=>{
                    const btn = document.createElement("button");
                    btn.textContent = league.label;
                    btn.onclick = () => fetchMatches(league.name, isPast);
                    targetButtons.appendChild(btn);
                });
            }

            function fetchMatches(selectedLeague, isPast){
                const dateInput = document.getElementById("match-date").value;
                if(!dateInput){ alert("Please select a date"); return; }

                const formattedDate = formatDate(dateInput);
                const url = `/matches?date=${formattedDate}&league=${encodeURIComponent(selectedLeague)}`;
                const parts = dateInput.split("-");
                const selectedDate = new Date(parts[0], parts[1]-1, parts[2]); 

                fetch(url).then(res=>res.json()).then(data=>{
                    const container = document.getElementById("matches-container");
                    container.innerHTML = "";
                    const now = new Date();
                    now.setHours(0,0,0,0);

                    if(!data || data.length===0){
                        document.getElementById("message").innerText = `No matches found for ${formattedDate}${selectedLeague ? " in "+selectedLeague : ""}`;
                        container.style.display = "none";
                        return;
                    }

                    let filteredMatches = data.filter(match => {
                        const matchDateStr = match["@date"];
                        const matchTimeStr = match["@time"] || "00:00";
                        const [day, month, year] = matchDateStr.split(".");
                        const [hour, minute] = matchTimeStr.split(":");
                        const matchDateTime = new Date(year, month-1, day, hour, minute);

                        const status = match["@status"] === "LIVE" ? "live" : (matchDateTime < now ? "past" : "upcoming");
                        match._status = status;

                        if(isPast){
                            return matchDateTime.toDateString() === selectedDate.toDateString();
                        } else {
                            return status !== "past";
                        }
                    });

                    filteredMatches.sort((a,b)=>{
                        const [d1,h1] = [a["@date"], a["@time"]||"00:00"];
                        const [d2,h2] = [b["@date"], b["@time"]||"00:00"];
                        const [day1, month1, year1] = d1.split("."); 
                        const [day2, month2, year2] = d2.split(".");
                        const [hour1, min1] = h1.split(":"); 
                        const [hour2, min2] = h2.split(":");
                        return new Date(year1, month1-1, day1, hour1, min1) - new Date(year2, month2-1, day2, hour2, min2);
                    });

                    if(!isPast){ filteredMatches = filteredMatches.slice(0, 8); }

                    if(filteredMatches.length === 0){
                        document.getElementById("message").innerText = "No matches found for the selected date.";
                        container.style.display = "none";
                        return;
                    } else {
                        document.getElementById("message").innerText = "";
                    }

                    filteredMatches.forEach(match => {
                        const card = document.createElement("div");
                        card.classList.add("match-card", match._status);

                        const localTeam = match.localteam["@name"];
                        const visitorTeam = match.visitorteam["@name"];
                        const localGoals = match.localteam["@score"]||0;
                        const visitorGoals = match.visitorteam["@score"]||0;

                        card.innerHTML = `
                            <div class="team-name">${localTeam} vs ${visitorTeam}</div>
                            <div class="score">${localGoals} - ${visitorGoals}</div>
                            <div class="match-header">${match["@date"]} • ${match["@time"]} <br> ${match.league}</div>
                        `;

                        if(match._status === "past" && match.events && match.events.length){
                            const toggleBtn = document.createElement("button");
                            toggleBtn.textContent = "Show Events";
                            toggleBtn.style.marginTop = "10px";
                            toggleBtn.style.padding = "5px 10px";
                            toggleBtn.style.cursor = "pointer";
                            toggleBtn.style.borderRadius = "5px";
                            toggleBtn.style.border = "none";
                            toggleBtn.style.backgroundColor = "#007bff";
                            toggleBtn.style.color = "#fff";

                            const eventsDiv = document.createElement("div");
                            eventsDiv.classList.add("events");
                            eventsDiv.innerHTML = match.events.map(ev => {
                                let typeClass='', typeLabel='', info='';
                                if(ev.type === "goal"){
                                    typeClass='goal'; typeLabel='Goal'; info=`${ev.player} (${ev.team}) [${ev.score}]`;
                                } else if(ev.type==="booking"){
                                    typeClass='booking'; typeLabel='Booking'; info=`${ev.player} (${ev.team})`;
                                } else if(ev.type==="substitution"){
                                    typeClass='substitution'; typeLabel='Sub'; info=`${ev.player_out} → ${ev.player_in} (${ev.team})`;
                                }
                                return `<div class="event-item">
                                            <div class="event-type ${typeClass}">${typeLabel}</div>
                                            <div class="event-info">${info}</div>
                                            <div class="event-time">${ev.minute}'</div>
                                        </div>`;
                            }).join('');

                            toggleBtn.addEventListener("click", ()=>{
                                eventsDiv.classList.toggle("show");
                                toggleBtn.textContent = eventsDiv.classList.contains("show") ? "Hide Events" : "Show Events";
                            });

                            card.appendChild(toggleBtn);
                            card.appendChild(eventsDiv);
                        }

                        container.appendChild(card);
                    });

                    container.style.display = "flex";
                }).catch(err=>console.error(err));
            }

            function fetchNearestUpcoming(leagueName){
                fetch(`/matches?league=${encodeURIComponent(leagueName)}`)
                    .then(res => res.json())
                    .then(data => {
                        const container = document.getElementById('upcoming-container');
                        container.innerHTML = "";  // clear previous

                        if(!data || data.length === 0){
                            container.innerHTML = `<div style="color:#ff7f50; font-weight:bold; font-size:16px;">
                                No upcoming matches for ${leagueName}.</div>`;
                            return;
                        }

                        // take first 5 upcoming matches
                        const upcomingMatches = data.slice(0, 5);

                        upcomingMatches.forEach(match => {
                        const card = document.createElement('div');
                        card.classList.add('match-card', 'upcoming');
                        card.style.Width = '200px'; // same as live cards
                        card.style.maxWidth = '230px'; // same as live cards
                        card.style.margin = '0';        // remove extra margin
                        card.innerHTML = `
                            <div class="match-header">${match.league}</div>
                            <div class="team-name">${match.localteam["@name"]} vs ${match.visitorteam["@name"]}</div>
                            <div class="score"> --- : --- </div>
                            <div class="match-info">
                                <span>Date: ${match["@date"]}</span> | 
                                <span>Time: ${match["@time"] || "TBD"}</span> | 
                                <span>Venue: ${match["@venue"] || "TBD"}</span>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                    })
                    .catch(err => console.error(err));
            }

            </script>
            
        </div>
        </div>

        <div id="table" class="tab-content">
            <p>League tables will be shown here.</p>
        </div>
        <!-- <div id="players-header"></div> -->
        <div id="players-header" style="text-align:center; font-size:1.3rem; font-weight:500; margin:20px 0; color:#222;"></div>


        <div id="top-players" class="tab-content"><div id="players-table-container"></div></div>
        <!-- <div id="fighters-header"></div> -->
        <div id="fighters-header" style="text-align:center; font-size:1.3rem; font-weight:500; margin:20px 0; color:#222;"></div>
        <div id="top-fighters" class="tab-content"><div id="fighters-table-container"></div></div>
    </main>

    <footer>
        <p>&copy; 2025 TcR Arena. All rights reserved. |
        <a href="{{ url_for('privacy') }}">Privacy Policy</a> |
        <a href="{{ url_for('join') }}">Contact</a>
        </p>
    </footer>
    <script>
    function toggleEvents(id){
        const el=document.getElementById(id);
        el.style.display = (el.style.display==="none")?"block":"none";
    }

    function formatDateToDDMMYYYY(dateStr){
        const d = new Date(dateStr);
        const day = String(d.getDate()).padStart(2,'0');
        const month = String(d.getMonth()+1).padStart(2,'0');
        const year = d.getFullYear();
        return `${day}/${month}/${year}`;
    }

    (function setDatePickerLimits(){
        const today = new Date();
        const past7 = new Date(); past7.setDate(today.getDate()-7);
        const next7 = new Date(); next7.setDate(today.getDate()+7);
        function formatForInput(d){
            const yyyy=d.getFullYear(), mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
            return `${yyyy}-${mm}-${dd}`;
        }
        const dateInput=document.getElementById('search-date');
        dateInput.min=formatForInput(past7);
        dateInput.max=formatForInput(next7);
    })();


    
    function searchMatches(){
    const dateInput=document.getElementById('search-date').value;
    if(!dateInput) return alert('Please select a date');
    const formattedDate=formatDateToDDMMYYYY(dateInput);

    // define leagues you want to allow
    const highlight_leagues = [
        "England: Premier League",
        "Spain: La Liga",
        "Italy: Serie A",
        "Germany: Bundesliga",
        "Europe: UEFA Champions League",
        "Saudi Arabia: Saudi Professional League",
        "Bhutan: Premier League",
        "Premier League",
        "La Liga",
        "Bundesliga",
        "Serie A",
        "Saudi Pro League",
        "UAE Pro League",
        "FIFA World Cup",
    ];

    fetch(`/search?date=${formattedDate}`)
        .then(res=>res.json())
        .then(data=>{
            const container=document.getElementById('search-results');
            if(data.error){ 
                container.innerHTML=`<p style="color:red;">${data.error}</p>`; 
                return;
            }

            // filter matches by allowed leagues
            const filteredMatches = data.matches.filter(m => highlight_leagues.includes(m.league));

            if(filteredMatches.length===0){ 
                container.innerHTML="<p>No matches found.</p>"; 
                return;
            }

            let html='';
            filteredMatches.forEach((m,i)=>{
                html+=`<div class="search-card">
                    <div class="match-header">
                        <div class="match-info">${m.date} | ${m.league} | ${m.venue}</div>
                        <div class="match-info">${m.status} | ${m.time}</div>
                    </div>
                    <div class="teams">
                        <div>${m.league_id ? `<a href="/team/${m.league_id}/${encodeURIComponent(m.local_team)}">${m.local_team}</a>` : m.local_team}</div>
                        <div class="score">${m.local_goals} - ${m.visitor_goals}</div>
                        <div>${m.league_id ? `<a href="/team/${m.league_id}/${encodeURIComponent(m.visitor_team)}">${m.visitor_team}</a>` : m.visitor_team}</div>
                    </div>
                    <button class="expand-btn" onclick="toggleEvents('search-events-${i}')">View Events</button>
                    <div id="search-events-${i}" style="display:none; margin-top:10px;">`;
                if(m.events.length){
                    html+=`<table class="events-table"><tr><th>Minute</th><th>Type</th><th>Team</th><th>Player</th><th>Assist</th><th>Score</th></tr>`;
                    m.events.forEach(ev=>{
                        html+=`<tr>
                            <td>${ev.minute}${ev.extra_min? '+'+ev.extra_min:''}</td>
                            <td>${ev.type}</td><td>${ev.team}</td><td>${ev.player}</td><td>${ev.assist}</td><td>${ev.result}</td>
                        </tr>`;
                    });
                    html+='</table>';
                } else { html+='<i>No events</i>'; }
                html+='</div></div>';
            });
            container.innerHTML=html;
        })
        .catch(err=>document.getElementById('search-results').innerHTML=`<p style="color:red;">Error: ${err}</p>`);
}

    function filterSearchResults() {
        const filterText = document.getElementById('filter-league-venue').value.toLowerCase();
        const cards = document.querySelectorAll('#search-results .search-card');
        cards.forEach(card => {
            const matchInfo = card.querySelector('.match-header .match-info:first-child').innerText.toLowerCase();
            card.style.display = matchInfo.includes(filterText) ? '' : 'none';
        });
    }

    function openTab(evt, tabName) {
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(tc => tc.style.display = 'none');

        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(btn => btn.classList.remove('active'));

        document.getElementById(tabName).style.display = 'block';
        evt.currentTarget.classList.add('active');
    }

    // Mobile nav toggle
    document.getElementById('navToggle').addEventListener('click', function() {
        document.getElementById('navMenu').classList.toggle('active');
    });

    function showSport(sport) {
        const container = document.getElementById('players-table-container');
        fetch(`/top-players-json?sport=${encodeURIComponent(sport)}`)
            .then(res => res.json())
            .then(data => {
                if (!data.players || data.players.length === 0) {
                    container.innerHTML = "<p>No players found for " + sport + ".</p>";
                    return;
                }

                let html = `<table class="events-table">
                    <tr>
                        <th>Rank</th>
                        <th>Player Name</th>
                        <th>Club (2025)</th>
                        <th>Nationality</th>
                        <th>Source(s)</th>
                        <th>Credits</th>
                    </tr>`;

                data.players.forEach(p => {
                    html += `<tr>
                        <td>${p.rank}</td>
                        <td>${p.player_name}</td>
                        <td>${p.club || ''}</td>
                        <td>${p.nationality || ''}</td>
                        <td>${p.sources || ''}</td>
                        <td>${p.credits || ''}</td>
                    </tr>`;
                });

                html += '</table>';
                container.innerHTML = html;
            })
            .catch(err => container.innerHTML = `<p style="color:red;">Error loading players: ${err}</p>`);
    }


    function showSport(sport) {
    // Hide fighters header
    document.getElementById('fighters-header').innerText = '';
    document.getElementById('players-list').style.display = 'none';

    // Switch to the Top Players tab
    document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
    document.getElementById('top-players').style.display = 'block';

    const now = new Date();
    const month = now.toLocaleString('default', { month: 'long' }).toUpperCase();
    const year = now.getFullYear();

    const container = document.getElementById('players-table-container');
    fetch(`/top-players-json?sport=${encodeURIComponent(sport)}`)
    .then(res => res.json())
    .then(data => {
        if (!data.players || data.players.length === 0) {
            container.innerHTML = "<p>No players found for " + sport + ".</p>";
            return;
        }

       let html = `<table class="events-table">
        <tr class="table-header-row">
            <th colspan="6">
                ${sport.toUpperCase()} TOP PLAYER | MONTH: ${month} ${year}
            </th>
        </tr>
        <tr class="table-column-headers">
            <th>Rank</th>
            <th>Player Name</th>
            <th>Club (${year})</th>
            <th>Nationality</th>
            <th>Source(s)</th>
            <th>Credits</th>
        </tr>`;


        data.players.forEach(p => {
            html += `<tr>
                <td>${p.rank}</td>
                <td>${p.player_name}</td>
                <td>${p.club || ''}</td>
                <td>${p.nationality || ''}</td>
                <td>${p.sources || ''}</td>
                <td>${p.credits || ''}</td>
            </tr>`;
        });

        html += '</table>';
        container.innerHTML = html;
    })
    .catch(err => container.innerHTML = `<p style="color:red;">Error loading players: ${err}</p>`);
}

function showFighters(sport) {
    document.getElementById('players-header').innerText = '';
    document.getElementById('fighters-list').style.display = 'none';
    document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
    document.getElementById('top-fighters').style.display = 'block';

    const now = new Date();
    const month = now.toLocaleString('default', { month: 'long' }).toUpperCase();
    const year = now.getFullYear();

    const container = document.getElementById('fighters-table-container');
    fetch(`/top-fighters-json?sport=${encodeURIComponent(sport)}`)
    .then(res => res.json())
    .then(data => {
        if (!data.players || data.players.length === 0) {
            container.innerHTML = "<p>No fighters found for " + sport + ".</p>";
            return;
        }

        let html = `<table class="events-table">
        <tr class="table-header-row">
            <th colspan="6">
                ${sport.toUpperCase()} TOP FIGHTER | MONTH: ${month} ${year}
            </th>
        </tr>
        <tr class="table-column-headers">
            <th>Rank</th>
            <th>Fighter Name</th>
            <th>Club (${year})</th>
            <th>Nationality</th>
            <th>Source(s)</th>
            <th>Credits</th>
        </tr>`;


        data.players.forEach(p => {
            html += `<tr>
                <td>${p.rank}</td>
                <td>${p.player_name}</td>
                <td>${p.club || ''}</td>
                <td>${p.nationality || ''}</td>
                <td>${p.sources || ''}</td>
                <td>${p.credits || ''}</td>
            </tr>`;
        });

        html += '</table>';
        container.innerHTML = html;
    })
    .catch(err => container.innerHTML = `<p style="color:red;">Error loading fighters: ${err}</p>`);
}

    function toggleTopPlayersList() {
        const list = document.getElementById("top-players-list");
        list.style.display = (list.style.display === "none") ? "block" : "none";
    }
    function togglePlayersList() {
        const list = document.getElementById("players-list");
        list.style.display = (list.style.display === "block") ? "none" : "block";
    }

    function toggleFightersList() {
        const list = document.getElementById("fighters-list");
        list.style.display = (list.style.display === "block") ? "none" : "block";
    }

    function toggleTableList() {
    const list = document.getElementById("table-list");
    list.style.display = (list.style.display === "block") ? "none" : "block";
}
    // Close list if clicked outside

    document.addEventListener("click", function(event) {
        if (!document.querySelector("#players-list").contains(event.target) &&
            !event.target.closest("button[onclick='togglePlayersList()']")) {
            document.getElementById("players-list").style.display = "none";
        }
        if (!document.querySelector("#fighters-list").contains(event.target) &&
            !event.target.closest("button[onclick='toggleFightersList()']")) {
            document.getElementById("fighters-list").style.display = "none";
        }
       
        if (!document.querySelector("#table-list").contains(event.target) &&
            !event.target.closest("button[onclick='toggleTableList()']")) {
            document.getElementById("table-list").style.display = "none";
        }
    });

    function showTable(category) {
    // Hide other dropdown headers
    document.getElementById('players-header').innerText = '';
    document.getElementById('fighters-header').innerText = '';

    // Show TABLE tab content
    document.querySelectorAll('.tab-content').forEach(tc => tc.style.display = 'none');
    document.getElementById('table').style.display = 'block';

    let html = '<table class="events-table" style="width:100%;">';

    if(category === 'Football') {
        html += `
        <tr style="background:black; color:white; height:20px;">  <!-- increased height -->
            <td colspan="7" style="padding:10px 0;">
                <div class="button-container" style="justify-content:center; gap:10px; flex-wrap:wrap;">
                    <button class="oval-button" onclick="fetchFootballTable('Champions League')">Champions League</button>
                    <button class="oval-button" onclick="fetchFootballTable('Premier League')">Premier League</button>
                    <button class="oval-button" onclick="fetchFootballTable('La Liga')">La Liga</button>
                    <button class="oval-button" onclick="fetchFootballTable('Bundesliga')">Bundesliga</button>
                    <button class="oval-button" onclick="fetchFootballTable('Serie A')">Serie A</button>
                    <button class="oval-button" onclick="fetchFootballTable('Saudi Pro League')">Saudi Pro League</button>
                    <button class="oval-button" onclick="fetchFootballTable('UAE Pro League')">UAE Pro League</button>
                </div>
            </td>
        </tr>
        </table>
        <div id="football-table-container" style="margin-top:15px;"></div>`;
    } else if(category === 'Cricket') {
        html += `
        <tr style="background:black; color:white; height:80px;">  <!-- increased height -->
            <td colspan="4" style="padding:20px 0;">
                <div class="button-container" style="justify-content:center; gap:15px; flex-wrap:wrap;">
                    <button class="oval-button" style="min-width:200px; max-width:250px;" onclick="fetchCricketRanking('odi')">ICC Men's ODI Team</button>
                    <button class="oval-button" style="min-width:200px; max-width:250px;" onclick="fetchCricketRanking('test')">ICC Men's Test Team</button>
                    <button class="oval-button" style="min-width:200px; max-width:250px;" onclick="fetchCricketRanking('t20')">ICC Men's T20 Team</button>
                    <button class="oval-button" style="min-width:200px; max-width:250px;" onclick="fetchCricketRanking('ipl')">IPL Teams</button>
                </div>
            </td>
        </tr>
        </table>
        <div id="cricket-table-container"></div>`;
    }

    document.getElementById('table').innerHTML = html;

    // Hide the table dropdown
    document.getElementById("table-list").style.display = 'none';
    }

    function openTab(evt, tabName) {
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(tc => tc.style.display = 'none');

        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(btn => btn.classList.remove('active'));

        document.getElementById(tabName).style.display = 'block';
        evt.currentTarget.classList.add('active');

        // Hide TOP PLAYERS / TOP FIGHTERS headers for LIVE MATCH and TABLE tabs
        if (tabName === 'live' || tabName === 'table') {
            document.getElementById('players-header').innerText = '';
            document.getElementById('fighters-header').innerText = '';
        }
    }

    </script>
    <script>
    // Fetch Cricket ranking data from admin endpoint
    function fetchCricketRanking(type) {
        const container = document.getElementById('cricket-table-container');
        container.innerHTML = '<p>Loading...</p>';

        // Admin endpoint mapping
        let endpoint = `/cricket-rankings?type=${encodeURIComponent(type)}`;

        fetch(endpoint)
            .then(res => res.json())
            .then(data => {
                if(!data.teams || data.teams.length === 0) {
                    container.innerHTML = '<p>No data available.</p>';
                    return;
                }

                // Friendly titles for buttons
                let title = "";
                switch(type) {
                    case 'odi': title = "ICC Men's ODI Team"; break;
                    case 'test': title = "ICC Men's Test Team"; break;
                    case 't20': title = "ICC Men's T20 Team"; break;
                    case 'ipl': title = "IPL Teams"; break;
                    default: title = type.toUpperCase();
                }

                let html = `<h3>${title}</h3>`;
                html += '<table class="events-table">';
                html += '<tr><th>Rank</th><th>Team</th><th>Matches</th><th>Points</th><th>Rating</th></tr>';

                data.teams.forEach(team => {
                    html += `<tr>
                        <td>${team.rank}</td>
                        <td>${team.name}</td>
                        <td>${team.matches}</td>
                        <td>${team.points}</td>
                        <td>${team.rating}</td>
                    </tr>`;
                });

                html += '</table>';
                container.innerHTML = html;
            })
            .catch(err => {
                container.innerHTML = `<p style="color:red;">Error loading data: ${err}</p>`;
            });
    }
    </script>
    <script>
    function fetchFootballTable(league) {
        const container = document.getElementById('football-table-container');
        container.innerHTML = '<p>Loading...</p>';

        // Admin endpoint for football tables
        let endpoint = `/football-tables?league=${encodeURIComponent(league)}`;

        fetch(endpoint)
            .then(res => res.json())
            .then(data => {
                if(!data.teams || data.teams.length === 0) {
                    container.innerHTML = '<p>No data available.</p>';
                    return;
                }

                let html = `<h3 style="text-align:center">${league} Table</h3>`;
                html += '<table class="events-table">';
                html += '<tr><th>Rank</th><th>Team</th><th>Played</th><th>Won</th><th>Draw</th><th>Lost</th><th>Points</th></tr>';

                data.teams.forEach(team => {
                    html += `<tr>
                        <td>${team.rank}</td>
                        <td>${team.name}</td>
                        <td>${team.played}</td>
                        <td>${team.won}</td>
                        <td>${team.draw}</td>
                        <td>${team.lost}</td>
                        <td>${team.points}</td>
                    </tr>`;
                });

                html += '</table>';
                container.innerHTML = html;
            })
            .catch(err => {
                container.innerHTML = `<p style="color:red;">Error loading data: ${err}</p>`;
            });
    }
</script>

</body>
</html>
